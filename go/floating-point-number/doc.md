# 単精度浮動小数点数型の実装

## 概要

本プロジェクトは、Go言語の標準`float32`型を使用せずに、IEEE 754標準に準拠した単精度浮動小数点数型を独自実装することを目的としています。これにより、浮動小数点数の内部構造と演算メカニズムを深く理解することができます。

## IEEE 754標準 - 単精度浮動小数点数

### ビット構造
32ビットの単精度浮動小数点数は以下の構造を持ちます：

```
| 符号ビット | 指数部 (8ビット) | 仮数部 (23ビット) |
|    1bit   |     8bits      |     23bits      |
```

### 数値の表現
- **符号ビット**: 0 = 正数, 1 = 負数
- **指数部**: バイアス127の8ビット指数 (実際の指数 = 格納値 - 127)
- **仮数部**: 1.xxxの形式で正規化された23ビット仮数 (先頭の1は暗黙)

### 数値計算式
```
値 = (-1)^符号ビット × 1.仮数部 × 2^(指数部-127)
```

## 実装手順

### フェーズ1: 基本構造の強化
1. **ビット操作ヘルパー関数**
   - `setBit(index, value)`: 指定位置のビットを設定
   - `getBit(index)`: 指定位置のビットを取得
   - `shiftLeft(n)`, `shiftRight(n)`: ビットシフト操作

2. **数値正規化機能**
   - 非正規化数の正規化
   - 指数部の調整
   - 仮数部の正規化

### フェーズ2: 変換機能の実装
1. **基本変換**
   - `NewFromInt(int32)`: 整数から浮動小数点数への変換
   - `ToInt()`: 浮動小数点数から整数への変換
   - `FromBits(uint32)`: uint32からの変換
   - `ToBits()`: uint32への変換

2. **文字列変換**
   - `String()`: 文字列表現への変換
   - `ParseFloat(string)`: 文字列からの解析

### フェーズ3: 基本演算の実装
1. **加算 (Add)**
   - 指数部の調整
   - 仮数部の加算
   - 結果の正規化

2. **減算 (Sub)**
   - 符号処理
   - 絶対値の比較
   - 仮数部の減算

3. **乗算 (Mul)**
   - 符号の決定
   - 指数部の加算
   - 仮数部の乗算

4. **除算 (Div)**
   - 符号の決定
   - 指数部の減算
   - 仮数部の除算

### フェーズ4: 比較演算の実装
1. **等価判定 (Equal)**
2. **大小比較 (Greater, Less)**
3. **特殊値判定**
   - `IsZero()`: ゼロ判定
   - `IsNaN()`: NaN判定
   - `IsInf()`: 無限大判定

### フェーズ5: 特殊値の処理
1. **NaN (Not a Number)**
   - 指数部: 全て1 (255)
   - 仮数部: 0以外

2. **無限大 (Infinity)**
   - 指数部: 全て1 (255)
   - 仮数部: 0

3. **非正規化数 (Denormalized)**
   - 指数部: 全て0
   - 仮数部: 0以外

## 設計詳細

### データ構造
```go
type Float32 struct {
    sign     bit       // 符号ビット
    exponent [8]bit    // 指数部
    fraction [23]bit   // 仮数部
}

type bit struct {
    value uint8 // 0 or 1
}
```

### 演算アルゴリズム設計原則
1. **正確性**: IEEE 754標準に完全準拠
2. **効率性**: 不要な計算を避ける最適化
3. **可読性**: 理解しやすいコード構造
4. **拡張性**: 将来的な機能追加に対応

### エラーハンドリング
- オーバーフロー/アンダーフローの検出
- 不正な演算の検出
- 適切な特殊値の返却

## テスト計画

### 単体テスト
1. **基本演算テスト**
   - 各演算の正確性確認
   - 境界値でのテスト
   - 標準float32との比較

2. **特殊値テスト**
   - NaN, Infinity, Zero の処理
   - 非正規化数の処理

3. **変換テスト**
   - 整数変換の正確性
   - 文字列変換の正確性

### 統合テスト
1. **複合演算テスト**
2. **パフォーマンステスト**
3. **メモリ使用量テスト**

## パフォーマンス考慮事項

### 最適化ポイント
1. **ビット操作の効率化**
2. **不要な計算の省略**
3. **メモリアクセスの最小化**

### 制約事項
- 標準float32より演算速度が遅い
- メモリ使用量が多い（構造体のオーバーヘッド）

## 実装例

### 基本的な使用例
```go
// 数値の作成
a := NewFromInt(5)
b := NewFromInt(3)

// 演算
result := a.Add(b)
fmt.Println(result.String()) // "8.0"

// 比較
if a.Greater(b) {
    fmt.Println("a > b")
}
```

## 参考資料
- IEEE 754-2008 Standard for Floating-Point Arithmetic
- "What Every Computer Scientist Should Know About Floating-Point Arithmetic"
- Go言語仕様書